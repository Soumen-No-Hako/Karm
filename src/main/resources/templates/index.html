<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Project Dashboard</title>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <style>
        body {
            background-color: #f4f4f4; /* Light grey background */
        }

        .project-card {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            cursor: pointer;
            min-height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .project-card .card-title {
            font-weight: 400;
        }

        .project-card.active-project {
            transform: translateX(-15px) scale(1.02);
            box-shadow: 0 16px 24px 2px rgba(0, 0, 0, 0.14),
                        0 6px 30px 5px rgba(0, 0, 0, 0.12),
                        0 8px 10px -7px rgba(0, 0, 0, 0.2);
        }

        #work-item-slider {
            width: 320px;
        }
        #work-item-slider .subheader {
            font-size: 1.2rem;
            font-weight: 500;
            color: #424242;
        }

        /* Style for the empty state */
        .empty-state-container {
            margin-top: 5rem;
            color: #9e9e9e; /* Grey text */
        }
        .empty-state-container i {
            font-size: 8rem;
        }
    </style>
</head>
<body>

<main class="container" style="margin-top: 2rem;">

    <div class="row" th:if="${!#lists.isEmpty(projects)}">

        <div class="col s12 m6" th:each="project : ${projects}">

            <div class="card waves-effect project-card"
                 data-target="work-item-slider"
                 th:data-project-id="${project.projectId}"
                 th:data-project-name="${project.projectName}">

                <div class="card-content center-align">
                    <span class="card-title" th:text="${project.projectName}">Project Name</span>
                </div>

                <a class="btn-floating halfway-fab waves-effect waves-light red add-workitem-btn"
                   th:href="@{'/workitem/new/'+${project.projectId}}">
                    <i class="material-icons">add</i>
                </a>
            </div>
        </div>

    </div>


    <div th:if="${#lists.isEmpty(projects)}" class="center-align empty-state-container">

        <i class="material-icons">folder_open</i>

        <h4>No projects found.</h4>
        <p class="flow-text">Create a new one to get started.</p>

        <br/>
    </div>
        <a th:href="@{/project/new}" class="btn-large btn-floating waves-effect waves-light red" title="Create New Project">
            <i class="material-icons">add</i>
        </a>




</main>

<ul id="work-item-slider" class="sidenav right">
</ul>


<div id="workitem-data-store" style="display: none;" th:if="${!#lists.isEmpty(projects)}">

    <div th:each="project : ${projects}" th:id="'workitems-for-' + ${project.projectId}">

        <a th:if="${!#lists.isEmpty(project.workItems)}"
           th:each="item : ${project.workItems}"
           th:href="@{/workitem/{id}(id=${item.workItemId})}"
           class="collection-item waves-effect"
           th:text="${item.workItemTitle}">
            Work Item Link
        </a>

        <span th:if="${#lists.isEmpty(project.workItems)}" class="placeholder">
                No work items for this project.
            </span>

    </div>
</div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

<script>
        $(document).ready(function() {

            // --- Initialize Materialize Components ---
            var sidenavElems = document.querySelectorAll('.sidenav');
            var sidenavInstances = M.Sidenav.init(sidenavElems, {
                edge: 'right',
                onCloseStart: function() {
                    $('.project-card').removeClass('active-project');
                }
            });

            // Only run card click handlers if the cards actually exist
            if ($('.project-card').length > 0) {

                var slider = M.Sidenav.getInstance($('#work-item-slider'));

                // --- Click Handler for Project Cards ---
                $('.project-card').on('click', function() {

                    var projectId = $(this).data('project-id');
                    var projectName = $(this).data('project-name');
                    var workItemHtml = $('#workitems-for-' + projectId).html();
                    var $sliderContent = $('#work-item-slider');

                    $sliderContent.empty();

                    $sliderContent.append('<li><a class="subheader">' + projectName + '</a></li>');
                    $sliderContent.append('<li><div class="divider"></div></li>');

                    if (workItemHtml && !$(workItemHtml).hasClass('placeholder')) {
                        var $items = $(workItemHtml).map(function() {
                            return '<li>' + $(this).prop('outerHTML') + '</li>';
                        }).get().join('');
                        $sliderContent.append($items);
                    } else {
                        $sliderContent.append('<li><a class="grey-text">No work items found.</a></li>');
                    }

                    $('.project-card').removeClass('active-project');
                    $(this).addClass('active-project');

                    // slider.open(); // Not needed if using data-target
                });

                // --- Click Handler for the FAB ---
                $('.add-workitem-btn').on('click', function(e) {
                    e.stopPropagation();
                });
            }
        });
    </script>

</body>
</html>